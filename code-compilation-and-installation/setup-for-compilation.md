# Setup for Compilation

Source codes of TOUGH4 are distributed in two directories: TOUGH2022 and LinearSolverInterface. TOUGH2022 contains the source codes that provide the main functionalities of TOUGH, while LinearSolverInterface provides C++ interfaces to third-party linear solver libraries and other supporting functions written in C++. In general, the compilation of TOUGH4 involves the installation or compilation of the user selected third-party software (may include MPI, Metis, and linear solver libraries), Fortran source codes, and C++ source codes. After compilation, an executable will be created by linking all the compiled codes together. In order to successfully link the compiled libraries and object files, the compiler needs to know where the object files, the compiled libraries and their header files are located. Once the user fully understands the procedure, the TOUGH4 compilation process is quite straightforward.      &#x20;

Before starting the compilation, users need to decide on what will be included in the compilation. The decision can be made by editing the header file “toughSetUp.fi” which is in the Fortran source code folder TOUGH2022. Figure 2 shows the contents of the file “toughSetUp.fi”.  User needs to edit this file by commenting out the unwanted items or uncommenting wanted items. The scripts in this file include two sections: one is for Fortran and the other is for C++.  “!” and “//” are used for commenting out a line in Fortran and C++ section, respectively. In Fortran section, user can only edit lines 7-33, including: whether METIS is needed (line 7), which EOS modules or process models are included (line 8-19), whether parallel computing with MPI and/or OPENMP are allowed (line 21-22), and which linear solvers are included (line 23-33). Please do not edit other lines. In the C++ section, the selection (Line 68-81) of the items for compilation must be identical to their correspondent selection in the Fortran section. Please keep in mind, if one item of a third-party software or library is selected, corresponding software must be compiled and installed on the working computer.  For C++ header only libraries, the libraries must be copied into a subdirectory in LinearSolverInterface. Both AMGCL and VIENNACL are header only library. They are distributed with the TOUGH4 installation package. User does not need take care of compilation of the header only library. It will be done automatically together with the other C++ codes.  Users may download the most updated version of the header only libraries online to replace them. It is good practice by selecting only the necessary items in the compilation and making the executable smaller.

Figure 2 is for compilation of an executable for EOS2, EOS3, EOS7 and ECO2 modules with OPENMP, MPI and GPU hybrid parallel computing. Wellbore simulation is allowed by the executable compiled with current setup. This executable allows using Metis for mesh partitioning (if Metis is not included, a simple partition method based on element sequence is applied) and includes only linear solvers from AMGCL and VIENNACL with OPENCL GPU parallelization. The AMGCL is the default linear solver and always included in the compilation.

<figure><img src="../.gitbook/assets/Fig1.png" alt=""><figcaption><p>Figure 2. The contents of header file “toughSetUp.fi” for preprocessing of the source codes.</p></figcaption></figure>
