# Data Structure

In TOUGH4, many procedures and functions with data encapsulation are designed as modules. There are three most popular types of modules: property module, process modeling module, and function module. The property modules are designed to hold the property data of objects and their related functions and procedures. The most important property modules include modules for water properties, CO2 properties, brine properties, supercritical water properties, real gas properties, and geological media properties. Process modeling modules define the specific physical processes and perform related calculations. Main processing modeling modules include the EOS modules, wellbore simulation module, and biodegradation reaction module. The function modules perform calculations for specific tasks, such as the modules for domain decomposition, MPI parallel computing, and mesh maker.&#x20;

Modules are also used to group data with common purpose together.  User defined structures or derived data types are widely used to store a group of related data. For example, all the rock related parameters are grouped into a data type PFMedium, all source/sink related parameters are grouped into a data type SourceSink, all secondary parameters are grouped into a data type Second\_Variable, and many other data. Figure 12 shows the definition of Second\_Variable.

<figure><img src="../.gitbook/assets/image (22).png" alt=""><figcaption><p>Figure 12. An example of derived data type-the derived data type for secondary variables</p></figcaption></figure>

Adoption of Second\_Variable data type makes the codes get rid of the complex array indexing for PAR used in previous version. The use of derived data type helps the management of program data and improves readability of the source codes.&#x20;

In TOUGH4, the matrix and right-hand-side vector of the linear equation system formed in the Newton-Raphson iteration are stored in a standard distributed CSR (Compressed Sparse Row) format. CSR originated in high-performance scientific computing as a way to represent sparse matrices, whose rows contain mostly zeros. The basic idea is to pack the column indices of non-zero entries into a dense array. CSR is more compact and is laid out more contiguously in memory than adjacency lists and adjacency vectors, eliminating nearly all space overheads and reducing random memory accesses compared with these other formats. Distributed CSR is the matrix and vector of CSR format distributed among multiple CPUs, which is widely used for solving linear equations with MPI parallel computing. By using this standard format, it is easy to interface TOUGH with the public domain third-party linear solver libraries. In addition, TOUGH4 provides a function for converting the CSR to BSR (Block Compressed Sparse Row) format to achieve additional efficiency for some solvers.
